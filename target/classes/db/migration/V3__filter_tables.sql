-- Aggregation BIC filter
-- filter_type: ALLOWED_BIC  = 8-char receiver BICs that should be aggregated
--              EXCLUDED_BRANCH = branch suffixes (last 3 chars of 11-char BIC) to skip
CREATE TABLE aggregation_bic_filter (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    bic_value VARCHAR(20) NOT NULL,
    filter_type VARCHAR(20) NOT NULL,
    active BOOLEAN NOT NULL DEFAULT TRUE,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_agg_filter_type ON aggregation_bic_filter(filter_type, active);

-- Routing BIC exclusion
-- Receiver BICs that skip preference-based routing entirely
CREATE TABLE routing_bic_exclusion (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    receiver_bic VARCHAR(20) NOT NULL,
    active BOOLEAN NOT NULL DEFAULT TRUE,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_route_excl_active ON routing_bic_exclusion(active);

-- Seed with the BICs that were previously in application.yml
INSERT INTO aggregation_bic_filter (bic_value, filter_type, active) VALUES ('BANKGB22', 'ALLOWED_BIC', true);
INSERT INTO aggregation_bic_filter (bic_value, filter_type, active) VALUES ('CLIENTBI', 'ALLOWED_BIC', true);
